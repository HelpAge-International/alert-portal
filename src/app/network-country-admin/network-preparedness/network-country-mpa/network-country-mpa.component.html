<ng-container *ngIf="!isViewing; else country">
  <ng-container *ngIf="!isLocalNetworkAdmin; else localNetworkAdmin">
    <app-network-country-header></app-network-country-header>
    <app-network-country-menu></app-network-country-menu>
  </ng-container>
</ng-container>

<ng-template #localNetworkAdmin>
  <app-local-network-header></app-local-network-header>
  <app-local-network-menu></app-local-network-menu>
</ng-template>

<ng-template #country>
  <ng-container *ngIf="!isLocalNetworkAdmin">
    <app-country-admin-header></app-country-admin-header>
    <app-network-country-menu [isViewing]="isViewing"></app-network-country-menu>
  </ng-container>
  <ng-container *ngIf="isLocalNetworkAdmin">
    <app-country-admin-header></app-country-admin-header>
    <app-local-network-menu [isViewing]="isViewing"></app-local-network-menu>
  </ng-container>
</ng-template>

<app-alert-loader *ngIf="showLoader"></app-alert-loader>

<app-status-alert [message]="alertMessage?.message" [success]="alertMessage?.type === alertMessageType.Success"
                  [show]="alertMessage"></app-status-alert>

<!-- EXPORT DOCUMENTS MODAL -->
<div class="modal fade" id="export_documents" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">{{"DOCUMENTS.EXPORT" | translate}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="text-center"><p>{{"YOU_ARE_ABOUT_TO_EXPORT" | translate}} <strong>{{documents.length}}
          {{"DOCUMENT_S" | translate}} </strong>{{"AGENCY_ADMIN.SETTINGS.DOCUMENTS.WITH_SIZE" | translate}} <strong>{{docsSize
          | number:'1.0-2'}}MB</strong> {{"ARE_YOU_SURE_YOU_WISH_TO_CONTINUE" | translate}}</p></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" (click)="closeExportModal()">{{"GLOBAL.CANCEL" |
          translate}}
        </button>
        <button type="button" class="btn btn-primary" (click)="exportAllDocsFromModal(documentActionId)">
          {{"GLOBAL.CONFIRM" | translate}}
        </button>
      </div>
    </div>
  </div>
</div>


<!-- PAGE -->
<div class="Page-top__wrap--w_sub_header--no-paddng">
  <div class="Full-page__wrap--inner">

    <!--<div *ngIf="!isViewing">-->
    <!--<ng-template [ngIf]="countrySelected && !agencySelected">-->
    <!--<app-agency-submenu [countryId]="countryId"></app-agency-submenu>-->
    <!--<app-alert-widget [countryId]="countryId"></app-alert-widget>-->
    <!--</ng-template>-->
    <!--<ng-template [ngIf]="agencySelected">-->
    <!--<app-country-submenu [agencyId]="agencyId" [countryId]="countryId"></app-country-submenu>-->
    <!--<app-alert-widget [countryId]="countryId"></app-alert-widget>-->
    <!--</ng-template>-->
    <!--</div>-->

    <div class="Header-title__wrap">
      <h1>{{"MINIMUM_PREP_ACTIONS_TITLE" | translate}}</h1>
      <!-- Tooltip partial -->
      <tooltip [level1]="'TOOLTIPS.PREPAREDNESS.TT1.LEVEL1'"
               [level2]="'TOOLTIPS.PREPAREDNESS.TT1.LEVEL2'">
      </tooltip>

      <div class="btn-group"
           *ngIf="!userType || (isViewing && (permissionsAreEnabled.customMPA.New || userType == userTypes.CountryAdmin))">
        <button type="button" class="btn btn-primary" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          {{"CREATE_ACTION" | translate}}
        </button>
        <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
          <span class="sr-only">{{"TOGGLE_DROPDOWN" | translate}}</span>
        </button>
        <div class="dropdown-menu">
          <a class="dropdown-item"
             [routerLink]="isViewing ? ['/network-country/network-country-create-edit-action', networkViewValues] : isLocalNetworkAdmin ? ['/network-country/network-country-create-edit-action',{'isLocalNetworkAdmin':true}] :['/network-country/network-country-create-edit-action']">{{"CREATE_CUSTOM_ACTIONS"
            | translate}}</a>
          <a class="dropdown-item"
             [routerLink]="isViewing ? ['/network-country/network-country-select-action', networkViewValues] : isLocalNetworkAdmin ? ['/network-country/network-country-select-action', {'isLocalNetworkAdmin':true}] : ['/network-country/network-country-select-action']">{{"SELECT_FROM_GENERIC_ACTIONS"
            | translate}}</a>
        </div>
      </div>
    </div>

    <!--
             START :: FILTERS
    -->
    <div class="row align-items-center Filter-form">
      <div class="col-lg-1 col-md-1 col-sm-6">
        {{"GLOBAL.FILTER" | translate}}
      </div>
      <div class="col-lg-2 col-md-2 col-sm-6">
        <!-- STATUS -->
        <select class="form-control" id="ActionStatusFilter" [(ngModel)]="filterStatus">
          <option value="-1" selected>{{"ACTION_STATUS" | translate}}</option>
          <option *ngFor="let x of ACTION_STATUS; let i = index" [attr.data-index]="i" value="{{i}}">{{ACTION_STATUS[i]
            | translate}}
          </option>
        </select>
      </div>
      <div class="col-lg-2 col-md-2 col-sm-6 ">
        <!-- TYPE -->
        <select class="form-control" id="TypesFilter" [(ngModel)]="filterType">
          <option value="-1" selected>{{"ALL_TYPES" | translate}}</option>
          <option *ngFor="let x of ACTION_TYPE; let i = index" [attr.data-index]="i" value="{{i}}">{{ACTION_TYPE[i] |
            translate}}
          </option>
        </select>
      </div>
      <div class="col-lg-2 col-md-2 col-sm-6 ">
        <!-- ASSIGNED TOO -->
        <select class="form-control" id="AssignedFilter" [(ngModel)]="filterAssigned">
          <option value="-1">{{"UNASSIGNED" | translate}}</option>
          <option value="0">{{"ASSIGNED_TO_ANYONE" | translate}}</option>
          <!-- If it's me, show "Assigned to me" instead -->
          <option *ngFor="let x of ASSIGNED_TOO; let i = index" [attr.data-index]="i" value="{{x.id}}">{{x.isMe ?
            ('ASSIGN_TO_ME' | translate) : x.firstName + ' ' + x.lastName}}
          </option>
        </select>
      </div>
    </div>

    <!--
             START :: ASSIGNED TOO
    -->
    <div class="Ribbon__section__wrap Spaced">
      <h2>{{"ACTIONS_ASSIGNED_TO" | translate}} {{
        filterAssigned == uid ? ("ME" | translate) : (filterAssigned == '0' ? ("ANYONE" | translate) :
        (CURRENT_USERS.get(filterAssigned) != null ? CURRENT_USERS.get(filterAssigned).firstName + ' ' +
        CURRENT_USERS.get(filterAssigned).lastName : ("NO_ONE" | translate))
        )
        }}</h2>

      <div *ngFor="let action of prepActionService.actions">

        <!-- FILTERING IF STATEMENT -->

        <div *ngIf="(!(!modulesAreEnabled.chsPreparedness && action.type == ActionType.chs)) &&
                    (filterType == -1 || action.type == filterType) &&
                    (filterDepartment == -1 || action.department == filterDepartment) &&
                    (filterAssigned == '0' || action.asignee == filterAssigned || ((action.asignee == '' || action.asignee == null) && filterAssigned == '-1')) &&
                    (filterStatus == -1 || filterStatus == ActionStatus.InProgress || filterStatus == ActionStatus.Completed || filterStatus == ActionStatus.Expired)">

          <!-- BELONGING IN THE MODULE IF STATEMENT -->
          <div
            *ngIf="!action.isArchived && (action.asignee != '' && action.asignee != null && action.asignee != undefined)">

            <!-- FILTERING BASED ON THE "COMPLETE/INPROGRESS/EXPIRED" filter -->
            <!-- Use the logic from the status block to determine this -->
            <div *ngIf="filterStatus == -1 ||
            ((action.asignee != '' && action.asignee != null && action.isComplete && (action.isCompleteAt + action.computedClockSetting > getNow())) && filterStatus == ActionStatus.Completed) ||
            ((action.asignee != '' && action.asignee != null && !action.isComplete && (action.updatedAt + action.computedClockSetting > getNow())) && filterStatus == ActionStatus.InProgress) ||
            ((!(action.asignee != '' && action.asignee != null && !action.isComplete && (action.updatedAt + action.computedClockSetting > getNow())) && !(action.asignee != '' && action.asignee != null && action.isComplete && (action.isCompleteAt + action.computedClockSetting > getNow()))) && filterStatus == ActionStatus.Expired)">

              <div class="Accordion Preparedness-list">
                <div class="Accordion Preparedness-list">
                  <div class="row Preparedness-list__item">


                    <!--
                   Everywhere that the following line is used it's just way of handling the "Expired on" state with the clock settings.
                   Based on those setting they're sometimes expired. This below checks that. It makes all the IF statements look
                   a bit messy but it has to be done like this so it's not dependent on a method resolution (and hence live updating gets a bit weird)

                   (actcalculatedIsCompletelete && (action.isCompleteAt + action.computedClockSetting < getNow())) || (!actcalculatedIsCompletelete && (action.updatedAt + action.computedClockSetting < getNow()))
                    -->

                    <!-- Logic for the clock settings -->
                    <div class="col-md-2 col-sm-2 border-right Preparedness-list__item--date"
                         *ngIf="!action.isComplete && (action.updatedAt + action.computedClockSetting >= getNow())">
                      {{"DUE_ON" | translate}} <strong>{{action.dueDate != null ? (action.dueDate | date:"d MMM ''yy")
                      : '-'}}</strong>
                    </div>
                    <div class="col-md-2 col-sm-2 border-right Preparedness-list__item--date"
                         *ngIf="!action.isComplete && (action.updatedAt + action.computedClockSetting < getNow())">
                      {{"EXPIRED_ON" | translate}} <strong>{{(action.updatedAt + action.computedClockSetting) |
                      date:"d MMM
                      ''yy"}}</strong>
                    </div>
                    <div class="col-md-2 col-sm-2 border-right Preparedness-list__item--date"
                         *ngIf="action.isComplete && (action.isCompleteAt + action.computedClockSetting < getNow())">
                      {{"EXPIRED_ON" | translate}} <strong>{{(action.isCompleteAt + action.computedClockSetting) |
                      date:"d MMM
                      ''yy"}}</strong>
                    </div>
                    <div class="col-md-2 col-sm-2 border-right Preparedness-list__item--date"
                         *ngIf="action.isComplete && (action.isCompleteAt + action.computedClockSetting >= getNow())">
                      {{"EXPIRES_ON" | translate}} <strong>{{(action.isCompleteAt + action.computedClockSetting) |
                      date:"d MMM
                      ''yy"}}</strong>
                    </div>


                    <div class="col-md-10 col-sm-10">
                      <div class="row">
                        <div class="col-md-5 col-sm-4" (click)="checkIfLink(action.task)">{{action.task}}</div>
                        <div class="col-md-2 col-sm-2"
                             [ngClass]="
                                         {
                                         'text-warning': action.asignee != '' && action.asignee != null && !action.isComplete && (action.updatedAt + action.computedClockSetting > getNow()),
                                         'text-success': action.asignee != '' && action.asignee != null && action.isComplete && (action.isCompleteAt + action.computedClockSetting > getNow()),
                                         'text-danger': !(action.asignee != '' && action.asignee != null && !action.isComplete && (action.updatedAt + action.computedClockSetting > getNow())) && !(action.asignee != '' && action.asignee != null && action.isComplete && (action.isCompleteAt + action.computedClockSetting > getNow()))
                                         }
                                         ">
                                         <span class="fa-stack">
                                            <i class="fa fa-circle fa-stack-2x"></i>
                                            <i class="fa fa-stack-1x fa-inverse"
                                               [ngClass]="
                                               {
                                               'fa-ellipsis-h': action.asignee != '' && action.asignee != null && !action.isComplete && (action.updatedAt + action.computedClockSetting > getNow()),
                                               'fa-check': action.asignee != '' && action.asignee != null && action.isComplete && (action.isCompleteAt + action.computedClockSetting > getNow()),
                                               'fa-times': !(action.asignee != '' && action.asignee != null && !action.isComplete && (action.updatedAt + action.computedClockSetting > getNow())) && !(action.asignee != '' && action.asignee != null && action.isComplete && (action.isCompleteAt + action.computedClockSetting > getNow()))
                                               }
                                               "></i>
                                        </span>
                          {{ACTION_STATUS[
                          action.asignee != '' && action.asignee != null && !action.isComplete && (action.updatedAt +
                          action.computedClockSetting > getNow()) ? 1 :
                          ((action.asignee != '' && action.asignee != null && action.isComplete &&
                          (action.isCompleteAt + action.computedClockSetting > getNow())) ? 2 : 0)] | translate}}
                        </div>
                        <div class="col-md-1 col-sm-1 text-primary Preparedness-list__item--entries">

                          <a href="javascript:void(0)" class="text-primary" data-toggle="collapse"
                             [attr.data-target]="'#notes_popover_' + action.id" aria-expanded="false"
                             [attr.aria-controls]="'notes_popover_' + action.id">
                            <div class="fa-stack">
                              <i class="fa fa-comment fa-stack-2x"></i>
                              <i class="fa fa-stack-1x fa-inverse">{{action.notes.length}}</i>
                            </div>
                            <span>{{"GLOBAL.NOTES" | translate}}</span>
                          </a>

                        </div>
                        <div class="col-md-1 col-sm-1 text-primary Preparedness-list__item--entries">

                          <a href="javascript:void(0)" class="text-primary" data-toggle="collapse"
                             [attr.data-target]="'#documents_popover_' + action.id" aria-expanded="false"
                             [attr.aria-controls]="'documents_popover_' + action.id"
                             *ngIf="action.documents.length > 0">
                            <div class="fa-stack">
                              <i class="fa fa-file fa-stack-2x"></i>
                              <i class="fa fa-stack-1x fa-inverse">{{action.documents.length}}</i>
                            </div>
                            <span>{{"DOC" | translate}}</span>
                          </a>

                        </div>
                        <div class="col-md-3 col-sm-4 btn-block"
                             *ngIf="!countrySelected">
                          <div
                            *ngIf="!action.isComplete && !(!action.isComplete && (action.updatedAt + action.computedClockSetting < getNow())) && action.asignee == uid">
                            <a href="javascript:void(0)" data-toggle="collapse"
                               [attr.data-target]="'#popover_content_' + action.id" aria-expanded="false"
                               aria-controls="popover_content"
                               class="btn btn-outline-primary btn-block ">{{"MARK_AS_COMPLETE" | translate}}</a>
                          </div>

                          <a
                            *ngIf="(action.asignee == uid && !isViewing) || (isViewing && ((action.level == actionLevelEnum.MPA && action.type == ActionType.custom && permissionsAreEnabled.customMPA.Edit) || (action.level == actionLevelEnum.APA && action.type == ActionType.custom && permissionsAreEnabled.customAPA.Edit)))"
                            [routerLink]="isViewing ? ['/network-country/network-country-create-edit-action', action.id, networkViewValues] : isLocalNetworkAdmin ? ['/network-country/network-country-create-edit-action', action.id, {'isLocalNetworkAdmin':true}] : ['/network-country/network-country-create-edit-action', action.id]"
                            class="btn btn-block">{{"EDIT_ACTION" | translate}}</a>
                        </div>
                        <!--<div class="col-md-3 col-sm-4 btn-block"-->
                        <!--*ngIf="isViewing && (action.type == ActionType.custom || (action.type == ActionType.mandated && !isSameAgency))">-->
                        <!--<a href="javascript:void(0)" (click)="copyAction(action)"-->
                        <!--class="btn btn-outline-primary btn-block ">{{"COPY_ACTION" | translate}}</a>-->
                        <!--</div>-->
                      </div>
                      <div class="row">
                        <div class="subrow-line">{{"AGENCY_ADMIN.SETTINGS.RESPONSE_PLAN_SECTION_SETTINGS.BUDGET" |
                          translate}}: <strong>{{CURRENCIES[currency]}}{{action.budget}}</strong></div>
                        <div class="subrow-line">{{"TYPE" | translate}}: <strong>{{ACTION_TYPE[action.type] |
                          translate}}</strong></div>
                        <!--<div class="subrow-line">{{"GLOBAL.DEPARTMENT" | translate}}:-->
                        <!--<strong>{{DEPARTMENT_MAP.get(action.department)}}</strong></div>-->
                        <div class="subrow-line">{{"ASSIGNED_TO" | translate}}: <strong>{{CURRENT_USERS.get(action.asignee)
                          != null ?
                          action.createdByAgencyId ? CURRENT_USERS.get(action.asignee).firstName + ' ' +
                          CURRENT_USERS.get(action.asignee).lastName +', ' +
                          agencyNamesMap.get(action.createdByAgencyId)?.name
                          :
                          CURRENT_USERS.get(action.asignee).firstName + ' ' +
                          CURRENT_USERS.get(action.asignee).lastName
                          : ("UNASSIGNED" | translate)}}</strong></div>

                      </div>
                    </div>

                    <div id="notes_popover_{{action.id}}"
                         class="Popover__ribbon prevent_parent_collapse collapse col-12 notes-popover">
                      <!-- Notes -->
                      <div class="row Spaced">
                        <div class="col-md-2"></div>
                        <div class="col-md-7">
                          <div class="row">
                            <div class="col-3">
                              <h4>{{"GLOBAL.NOTES" | translate}}</h4>
                            </div>
                            <div class="col-9">
                              <p>
                                <tooltip
                                  [level1]="'TOOLTIPS.PREPAREDNESS.TT5.LEVEL1'">
                                </tooltip>
                              </p>
                            </div>
                          </div>
                          <div class="row" *ngIf="userType == userTypes.CountryDirector || userType == userTypes.RegionalDirector || userType == userTypes.CountryAdmin || !userType
                                                || (isViewing && permissionsAreEnabled.notes.New) || (action.noteId != null && action.noteId != '')">
                            <div class="col-12 form-group">
                        <textarea name="confirm_complete" cols="40" rows="4" class="form-control"
                                  placeholder="{{'ADD_A_COMPLETION_NOTE_HERE' | translate}}"
                                  [(ngModel)]="action.note"></textarea>
                            </div>
                          </div>
                          <div class="row notes-popover__item Small-spaced" *ngFor="let note of action.notes">
                            <div class="col-sm-3">{{note.time | date:"d MMM yyyy"}}</div>
                            <div class="col-sm-9">
                              <div class="row">
                                <div class="col-12">
                                  {{note.content}}
                                </div>
                              </div>
                              <div class="row align-items-center">
                                <div class="col-6 text-bold Small-spaced">
                                  <p><span>{{"BY" | translate}}:</span> {{CURRENT_USERS.get(note.uploadedBy) != null ?
                                    CURRENT_USERS.get(note.uploadedBy).firstName + ' ' +
                                    CURRENT_USERS.get(note.uploadedBy).lastName : ("UNASSIGNED" | translate)}}</p>
                                </div>
                                <div class="col-6 text-bold text-right"
                                     *ngIf="userType == userTypes.CountryDirector || userType == userTypes.RegionalDirector || userType == userTypes.CountryAdmin || !userType
                                                || note.uploadedBy == uid && note.id != action.noteId">
                                  <a
                                    *ngIf="note.uploadedBy == uid && !isViewing || (isViewing && note.uploadedBy == uid && permissionsAreEnabled.notes.Edit)"
                                    href="javascript:void(0);" class="text-primary"
                                    (click)="editNote(note, action)">{{"EDIT" | translate}}</a>
                                  | <a
                                  *ngIf="note.uploadedBy == uid && !isViewing || (isViewing && note.uploadedBy == uid && permissionsAreEnabled.notes.Delete)"
                                  href="javascript:void(0);" class="text-danger"
                                  (click)="deleteNote(note, action)">{{"DELETE" | translate}}</a>
                                </div>
                                <div class="col-6 text-bold text-right" *ngIf="note.id == action.noteId">
                                  {{"EDITING" | translate}}
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-3 btn-block">
                          <a *ngIf="userType == userTypes.CountryDirector || userType == userTypes.RegionalDirector || userType == userTypes.CountryAdmin || !userType
                                                || (isViewing && permissionsAreEnabled.notes.New) || (action.noteId != null && action.noteId != '')"
                             href="javascript:void(0)" class="btn btn-primary btn-block"
                             (click)="addNote(action)">{{action.noteId != null && action.noteId != ''? ("SAVE_NOTE" |
                            translate) :
                            ("ADD_NOTE" | translate)}}</a>
                          <a href="javascript:void(0)" class="btn btn-block" (click)="disableEditNote(action)"
                             onClick="$(this).parent().parent().parent().collapse('hide')">{{"GLOBAL.CANCEL" |
                            translate}}</a>
                          <a href="javascript:void(0)" class="btn btn-block" (click)="disableEditNote(action)"
                             *ngIf="action.noteId != null && action.noteId != ''">{{"STOP_EDITING" | translate}}</a>
                        </div>
                      </div>

                    </div>

                    <div id="documents_popover_{{action.id}}"
                         class="Popover__ribbon prevent_parent_collapse collapse col-12 documents-popover">
                      <!-- Documents -->
                      <div class="row Spaced">
                        <div class="col-md-2"></div>
                        <div class="col-md-10">
                          <div class="row Spaced align-items-center">
                            <div class="col-sm-6 col-8">
                              <h4><span>{{"DOCUMENTS_TEXT" | translate}} </span>({{action.documents.length}})</h4>&nbsp;&nbsp;<a
                              *ngIf="userType == userTypes.CountryAdmin" href="javascript:void(0);"
                              class="text-nowrap"
                              (click)="exportAllDocuments(action)">{{"DOWNLOAD_ALL" | translate}}:</a>
                            </div>
                            <div class="col-sm-6 col-4 text-right">
                              <a (click)="closeDocumentsModal('documents_popover_' + action.id)"
                                 href="javascript:void(0)" class="btn btn-block">{{"GLOBAL.CLOSE" | translate}}</a>
                            </div>
                          </div>
                          <div class="row documents-popover__item">
                            <div class="col-12">
                              <p *ngFor="let doc of action.documents; let i = index" [attr.data-index]="i">
                                <strong>{{action.documents[i].fileName}}</strong>&nbsp;&nbsp;<span><a
                                *ngIf="uid == doc.uploadedBy || !userType || userType == userTypes.CountryAdmin || (isViewing && permissionsAreEnabled.other.DownloadDocuments)"
                                href="javascript:void(0);" (click)="exportDocument(action, i)">{{"DOWNLOAD" | translate}}</a> |
                                <a *ngIf="uid == doc.uploadedBy || userType == userTypes.CountryAdmin || !userType"
                                   href="javascript:void(0);" class="text-danger"
                                   (click)="deleteDocument(action, doc.documentId)">{{"DELETE" | translate}}</a></span>
                              </p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!--pop over for complete action confirmation-->
                <div id="popover_content_{{action.id}}"
                     class="Popover__ribbon prevent_parent_collapse collapse col-12 Popover__ribbon__no-arrow">
                  <!-- Mark as complete -->
                  <div class="row Spaced">
                    <div class="col-md-2"></div>
                    <div class="col-md-7">
                      <div class="row">
                        <div class="col-12">
                          <h4>{{"CONFIRM_THIS_ACTION_IS_COMPLETED" | translate}}</h4>
                          <!--tooltip-->
                          <tooltip
                            [level1]="'TOOLTIPS.PREPAREDNESS.TT3.LEVEL1'">
                          </tooltip>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-12 form-group">
                    <textarea name="confirm_complete" cols="40" rows="4" class="form-control"
                              placeholder="{{'ADD_A_COMPLETION_NOTE_HERE' | translate}}"
                              [(ngModel)]="action.note"></textarea>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-12">
                          <p><span>{{"ATTACH_DOCUMENTS_AS_PROOF_OF_COMPLETION" | translate}}</span>
                            {{action.requireDoc ? '(required)' : ''}}</p>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-12"><label for="docUpload{{action.id}}" class="btn btn-outline-primary">{{"UPLOAD_DOCUMENTS"
                          | translate}}:</label>
                        </div>
                        <!--tooltip-->
                        <tooltip
                          [level1]="'TOOLTIPS.PREPAREDNESS.TT4.LEVEL1'">
                        </tooltip>
                        <input type='file' id="docUpload{{action.id}}" name="file"
                               (change)="fileChange($event, action, action.id)"
                               class="Input-form--hidden"/>
                      </div>
                      <div class="row Spaced">
                        <div class="col-12">
                          <p *ngIf="action.attachments && action.attachments.length > 0"><span>{{"ATTACHMENTS" | translate}}</span>
                            ({{action.attachments.length}})</p>
                          <p *ngFor="let attachment of action.attachments">
                            <strong>{{attachment.name}}</strong>&nbsp;&nbsp;<a href="javascript:void(0)"
                                                                               class="text-danger"
                                                                               (click)="removeAttachment(action, attachment)">{{"GLOBAL.REMOVE"
                            | translate}}:</a>
                          </p>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 btn-block">
                      <a href="javascript:void(0)" class="btn btn-primary btn-block"
                         (click)="completeAction(action)">{{"GLOBAL.CONFIRM" | translate}}</a>
                      <a href="javascript:void(0)" class="btn btn-block"
                         onClick="$(this).parent().parent().parent().collapse('hide')">{{"GLOBAL.CANCEL" |
                        translate}}</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>


    <!--
             START :: UNASSIGNED
    -->
    <div class="Ribbon__section__wrap Spaced">
      <div class="Accordion--b-white Accordion__hide-links">
        <div class="row align-items-center no-gutters">
          <div class="col-sm-12">
            <h2>{{"UNASSIGNED_ACTIONS" | translate}}</h2>
            <a data-toggle="collapse" href="#collapseTwo" [attr.aria-expanded]="allUnassigned" class="Hide-all"
               [ngStyle]="{'display': allUnassigned ? 'inline' : 'none'}" (click)="showAllUnassigned(false)">{{"HIDE_ALL"
              | translate}}</a>
            <a data-toggle="collapse" href="#collapseTwo" [attr.aria-expanded]="allUnassigned" class="Show-all"
               [ngStyle]="{'display': !allUnassigned ? 'inline' : 'none'}" (click)="showAllUnassigned(true)">{{"SHOW_ALL"
              | translate}}</a>
          </div>
        </div>
      </div>
      <div class="Accordion__Content collapse show" id="collapseTwo">
        <div *ngFor="let action of prepActionService.actions">
          <!-- FILTERING IF STATEMENT -->
          <div *ngIf="(!(!modulesAreEnabled.chsPreparedness && action.type == ActionType.chs)) &&
                    (filterType == -1 || action.type == filterType) &&
                    (filterDepartment == -1 || action.department == filterDepartment) &&
                    (filterStatus == -1 || filterStatus == ActionStatus.Expired)">
            <!-- Asignee filter doesn't apply to UNASSIGNED actions: (filterAssigned == '0' || action.asignee == filterAssigned)-->
            <!-- BELONGING IN THE MODULE IF STATEMENT -->
            <div
              *ngIf="!action.isArchived && !(action.asignee != '' && action.asignee != null && action.asignee != undefined)">

              <div class="Accordion Preparedness-list">
                <div class="Accordion Preparedness-list">
                  <div class="row Preparedness-list__item">
                    <div class="col-md-2 col-sm-2 border-right Preparedness-list__item--date">{{"DUE_ON" | translate}}
                      <strong>{{action.dueDate
                        != null ? (action.dueDate
                        | date:"d MMM ''yy") : '-'}}</strong></div>
                    <div class="col-md-10 col-sm-10">
                      <div class="row">
                        <div class="col-md-5 col-sm-4" (click)="checkIfLink(action.task)">{{action.task}}</div>
                        <div class="col-md-2 col-sm-2 text-danger">
                          <span class="fa-stack">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-stack-1x fa-inverse fa-times"></i>
                          </span>{{ACTION_STATUS[0] | translate}}
                        </div>
                        <div class="col-md-1 col-sm-1 text-primary Preparedness-list__item--entries">

                          <a href="javascript:void(0)" class="text-primary" data-toggle="collapse"
                             [attr.data-target]="'#notes_popover_' + action.id" aria-expanded="false"
                             [attr.aria-controls]="'notes_popover_' + action.id">
                            <div class="fa-stack">
                              <i class="fa fa-comment fa-stack-2x"></i>
                              <i class="fa fa-stack-1x fa-inverse">{{action.notes.length}}</i>
                            </div>
                            <span>{{"GLOBAL.NOTES" | translate}}</span>
                          </a>
                        </div>
                        <div class="col-md-1 col-sm-1 text-primary Preparedness-list__item--entries">

                          <a href="javascript:void(0)" class="text-primary" data-toggle="collapse"
                             [attr.data-target]="'#documents_popover_' + action.id" aria-expanded="false"
                             [attr.aria-controls]="'documents_popover_' + action.id"
                             *ngIf="action.documents.length > 0">
                            <div class="fa-stack">
                              <i class="fa fa-file fa-stack-2x"></i>
                              <i class="fa fa-stack-1x fa-inverse">{{action.documents.length}}</i>
                            </div>
                            <span>{{"DOC" | translate}}</span>
                          </a>

                        </div>
                        <!--assign people-->
                        <div class="col-md-3 col-sm-4 btn-block" *ngIf="!countrySelected">
                          <a href="javascript:void(0)" data-toggle="modal" data-target="#leadAgencySelection"
                             aria-expanded="false" aria-controls="popover_content" *ngIf="!((action.type == ActionType.mandated && action.level == actionLevelEnum.MPA && isViewing))
                                    && !((action.type == ActionType.chs && action.level == actionLevelEnum.MPA && isViewing)) || (!((action.type == ActionType.mandated && action.level == actionLevelEnum.MPA && !isViewing && !permissionsAreEnabled.mandatedMPA.Assign))
                                    && !((action.type == ActionType.chs && action.level == actionLevelEnum.MPA && !isViewing && !permissionsAreEnabled.chsActions.Assign))
                                    && !((action.level == actionLevelEnum.MPA && !isViewing && !permissionsAreEnabled.customMPA.Assign)))"
                             class="btn btn-outline-primary btn-block" (click)="assignActionDialogAdv(action)">{{"ASSIGN_THIS_ACTION"
                            | translate}}</a>

                          <a
                            *ngIf="!((action.level == actionLevelEnum.MPA && action.type == ActionType.custom && isViewing) || (action.level == actionLevelEnum.APA && action.type == ActionType.custom && isViewing)) || !((action.level == actionLevelEnum.MPA && action.type == ActionType.custom && !isViewing && !permissionsAreEnabled.customMPA.Edit) || (action.level == actionLevelEnum.APA && action.type == ActionType.custom && !isViewing && !permissionsAreEnabled.customAPA.Edit))"
                            [routerLink]="isLocalNetworkAdmin ? ['/network-country/network-country-create-edit-action', action.id, {'isLocalNetworkAdmin':true}] : ['/network-country/network-country-create-edit-action', action.id]"
                            class="btn btn-block">{{"EDIT_ACTION" | translate}}</a>
                        </div>
                        <!--<div class="col-md-3 col-sm-4 btn-block"-->
                        <!--*ngIf="isViewing && (action.type == ActionType.custom || (action.type == ActionType.mandated && !isSameAgency))">-->
                        <!--<a href="javascript:void(0)" (click)="copyAction(action)"-->
                        <!--class="btn btn-outline-primary btn-block ">{{"COPY_ACTION" | translate}}</a>-->
                        <!--</div>-->
                      </div>
                      <div class="row">
                        <div class="subrow-line">{{"AGENCY_ADMIN.SETTINGS.RESPONSE_PLAN_SECTION_SETTINGS.BUDGET" |
                          translate}}: <strong>{{CURRENCIES[currency]}}{{action.budget}}</strong></div>
                        <div class="subrow-line">{{"GLOBAL.TYPE" | translate}}: <strong>{{ACTION_TYPE[action.type] |
                          translate}}</strong></div>
                        <!--<div class="subrow-line">{{"GLOBAL.DEPARTMENT" | translate}}:-->
                        <!--<strong>{{DEPARTMENT_MAP.get(action.department)}}</strong>-->
                        <!--</div>-->
                        <div class="subrow-line">{{"ASSIGNED_TO" | translate}}: <strong>{{CURRENT_USERS.get(action.asignee)
                          != null ?
                          CURRENT_USERS.get(action.asignee).firstName + ' ' +
                          CURRENT_USERS.get(action.asignee).lastName
                          : ("UNASSIGNED" | translate)}}</strong></div>

                      </div>
                    </div>
                  </div>

                  <!--notes popup-->
                  <div id="notes_popover_{{action.id}}"
                       class="Popover__ribbon prevent_parent_collapse collapse col-12 notes-popover">
                    <!-- Notes -->
                    <div class="row Spaced">
                      <div class="col-md-2"></div>
                      <div class="col-md-7">
                        <div class="row">
                          <div class="col-3">
                            <h4>{{"GLOBAL.NOTES" | translate}}</h4>
                          </div>
                          <div class="col-9">
                            <p>
                              <tooltip
                                [level1]="'TOOLTIPS.PREPAREDNESS.TT5.LEVEL1'">
                              </tooltip>
                            </p>
                          </div>
                        </div>
                        <div class="row" *ngIf="userType == userTypes.CountryDirector || userType == userTypes.RegionalDirector || userType == userTypes.CountryAdmin || !userType
                                                || (isViewing && permissionsAreEnabled.notes.New) || (action.noteId != null && action.noteId != '')">
                          <div class="col-12 form-group">
                        <textarea name="confirm_complete" cols="40" rows="4" class="form-control"
                                  placeholder="{{'ADD_A_COMPLETION_NOTE_HERE' | translate}}"
                                  [(ngModel)]="action.note"></textarea>
                          </div>
                        </div>
                        <div class="row notes-popover__item Small-spaced" *ngFor="let note of action.notes">
                          <div class="col-sm-3">{{note.time | date:"d MMM yyyy"}}</div>
                          <div class="col-sm-9">
                            <div class="row">
                              <div class="col-12">
                                {{note.content}}
                              </div>
                            </div>
                            <div class="row align-items-center">
                              <div class="col-6 text-bold Small-spaced">
                                <p><span>{{"BY" | translate}}:</span> {{CURRENT_USERS.get(note.uploadedBy) != null ?
                                  CURRENT_USERS.get(note.uploadedBy).firstName + ' ' +
                                  CURRENT_USERS.get(note.uploadedBy).lastName : ("UNASSIGNED" | translate)}}</p>
                              </div>
                              <div class="col-6 text-bold text-right"
                                   *ngIf="userType == userTypes.CountryDirector || userType == userTypes.RegionalDirector || userType == userTypes.CountryAdmin || !userType
                                                || note.uploadedBy == uid && note.id != action.noteId">
                                <a
                                  *ngIf="(note.uploadedBy == uid && !isViewing) || (note.uploadedBy == uid && isViewing && permissionsAreEnabled.notes.Edit)"
                                  href="javascript:void(0);" class="text-primary"
                                  (click)="editNote(note, action)">{{"EDIT" | translate}}</a>
                                | <a
                                *ngIf="(note.uploadedBy == uid && !isViewing) || (note.uploadedBy == uid && isViewing && permissionsAreEnabled.notes.Delete)"
                                href="javascript:void(0);" class="text-danger"
                                (click)="deleteNote(note, action)">{{"DELETE" | translate}}</a>
                              </div>
                              <div class="col-6 text-bold text-right" *ngIf="note.id == action.noteId">
                                {{"EDITING" | translate}}
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-3 btn-block">
                        <a *ngIf="userType == userTypes.CountryDirector || userType == userTypes.RegionalDirector || userType == userTypes.CountryAdmin || !userType
                                               || (isViewing && permissionsAreEnabled.notes.New) || (action.noteId != null && action.noteId != '')"
                           href="javascript:void(0)" class="btn btn-primary btn-block"
                           (click)="addNote(action)">{{action.noteId != null && action.noteId != ''? ("SAVE_NOTE" |
                          translate) :
                          ("ADD_NOTE" | translate)}}</a>
                        <a href="javascript:void(0)" class="btn btn-block" (click)="disableEditNote(action)"
                           onClick="$(this).parent().parent().parent().collapse('hide')">{{"GLOBAL.CANCEL" |
                          translate}}</a>
                        <a href="javascript:void(0)" class="btn btn-block" (click)="disableEditNote(action)"
                           *ngIf="action.noteId != null && action.noteId != ''">{{"STOP_EDITING" | translate}}</a>
                      </div>
                    </div>

                  </div>


                  <div id="documents_popover_{{action.id}}"
                       class="Popover__ribbon prevent_parent_collapse collapse col-12 documents-popover">
                    <!-- Documents -->
                    <div class="row Spaced">
                      <div class="col-md-2"></div>
                      <div class="col-md-10">
                        <div class="row Spaced align-items-center">
                          <div class="col-sm-6 col-8">
                            <h4><span>{{"DOCUMENTS_TEXT" | translate}} </span>({{action.documents.length}})</h4>
                            <!--tooltip-->
                            <tooltip
                              [level1]="'TOOLTIPS.PREPAREDNESS.TT6.LEVEL1'">
                            </tooltip>

                            &nbsp;&nbsp;<a *ngIf="userType == userTypes.CountryAdmin" href="javascript:void(0);"
                                           class="text-nowrap"
                                           (click)="exportAllDocuments(action)">{{"DOWNLOAD_ALL" | translate}}</a>
                          </div>
                          <div class="col-sm-6 col-4 text-right">
                            <a (click)="closeDocumentsModal('documents_popover_' + action.id)"
                               href="javascript:void(0)" class="btn btn-block">{{"GLOBAL.CLOSE" | translate}}</a>
                          </div>
                        </div>
                        <div class="row documents-popover__item">
                          <div class="col-12">
                            <p *ngFor="let doc of action.documents; let i = index" [attr.data-index]="i">
                              <strong>{{action.documents[i].fileName}}</strong>&nbsp;&nbsp;<span><a
                              *ngIf="uid == doc.uploadedBy || userType == userTypes.CountryAdmin || (isViewing && permissionsAreEnabled.other.DownloadDocuments)"
                              href="javascript:void(0);"
                              (click)="exportDocument(action, i)">{{"DOWNLOAD" | translate}}</a> |
                                <a *ngIf="uid == doc.uploadedBy || userType == userTypes.CountryAdmin"
                                   href="javascript:void(0);" class="text-danger"
                                   (click)="deleteDocument(action, doc.documentId)">{{"DELETE" | translate}}</a></span>
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>


    <!--
             START :: ARCHIVED
    -->
    <div class="Ribbon__section__wrap Spaced">
      <div class="Accordion--b-white Accordion__hide-links">
        <div class="row align-items-center no-gutters">
          <div class="col-sm-12">
            <h2>{{"ARCHIVED_ACTIONS" | translate}}</h2>
            <a data-toggle="collapse" href="#collapseThree" [attr.aria-expanded]="allArchived" class="Hide-all"
               [ngStyle]="{'display': allArchived ? 'inline' : 'none'}" (click)="showAllArchived(false)">{{"HIDE_ALL" |
              translate}}</a>
            <a data-toggle="collapse" href="#collapseThree" [attr.aria-expanded]="allArchived" class="Show-all"
               [ngStyle]="{'display': !allArchived ? 'inline' : 'none'}" (click)="showAllArchived(true)">{{"SHOW_ALL" |
              translate}}</a>
          </div>
        </div>
      </div>
      <div class="Accordion__Content collapse" id="collapseThree">
        <div *ngFor="let action of prepActionService.actions">
          <!-- FILTERING IF STATEMENT -->
          <div *ngIf="(!(!modulesAreEnabled.chsPreparedness && action.type == ActionType.chs)) &&
                    !(privacy?.chs != Privacy.Public && action.type == ActionType.chs) &&
                    (filterType == -1 || action.type == filterType) &&
                    (filterDepartment == -1 || action.department == filterDepartment) &&
                    (filterAssigned == '0' || action.asignee == filterAssigned || ((action.asignee == '' || action.asignee == null) && filterAssigned == '-1')) &&
                    (filterStatus == -1 || filterStatus == ActionStatus.Archived)">
            <!-- BELONGING IN THE MODULE IF STATEMENT -->
            <div *ngIf="action.isArchived">

              <div class="Accordion Preparedness-list">
                <div class="Accordion Preparedness-list">
                  <div class="row Preparedness-list__item">
                    <div class="col-md-2 col-sm-2 border-right Preparedness-list__item--date">{{"DUE_ON" | translate}}
                      <strong>{{action.dueDate
                        != null ? (action.dueDate
                        | date:"d MMM ''yy") : '-'}}</strong></div>
                    <div class="col-md-10 col-sm-10">
                      <div class="row">
                        <div class="col-md-5 col-sm-4" (click)="checkIfLink(action.task)">{{action.task}}</div>
                        <div class="col-md-2 col-sm-2 text-muted">
                   <span class="fa-stack">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-stack-1x fa-inverse fa-times"></i>
                   </span>
                          {{"GLOBAL.ACTION_STATUS.ARCHIVED" | translate}}
                        </div>
                        <div class="col-md-1 col-sm-1 text-primary Preparedness-list__item--entries">

                          <a href="javascript:void(0)" class="text-primary" data-toggle="collapse"
                             [attr.data-target]="'#notes_popover_' + action.id" aria-expanded="false"
                             [attr.aria-controls]="'notes_popover_' + action.id">
                            <div class="fa-stack">
                              <i class="fa fa-comment fa-stack-2x"></i>
                              <i class="fa fa-stack-1x fa-inverse">{{action.notes.length}}</i>
                            </div>
                            <span>{{"GLOBAL.NOTES" | translate}}</span>
                          </a>

                        </div>
                        <div class="col-md-1 col-sm-1 text-primary Preparedness-list__item--entries">

                          <a href="javascript:void(0)" class="text-primary" data-toggle="collapse"
                             [attr.data-target]="'#documents_popover_' + action.id" aria-expanded="false"
                             [attr.aria-controls]="'documents_popover_' + action.id"
                             *ngIf="action.documents.length > 0">
                            <div class="fa-stack">
                              <i class="fa fa-file fa-stack-2x"></i>
                              <i class="fa fa-stack-1x fa-inverse">{{action.documents.length}}</i>
                            </div>
                            <span>{{"DOC" | translate}}</span>
                          </a>

                        </div>
                        <div class="col-md-3 col-sm-4 btn-block" *ngIf="!countrySelected">
                          <a href="javascript:void(0)" data-toggle="collapse" data-target="#popover_content3"
                             aria-expanded="false" aria-controls="popover_content" (click)="reactivate(action)"
                             class="btn btn-outline-primary btn-block text-muted btn-outline-secondary">{{"GLOBAL.RE_ACTIVATE"
                            | translate}}</a>

                          <a
                            *ngIf="!((action.level == actionLevelEnum.MPA && action.type == ActionType.custom && !isViewing && !permissionsAreEnabled.customMPA.Edit) || (action.level == actionLevelEnum.APA && action.type == ActionType.custom && !isViewing && !permissionsAreEnabled.customAPA.Edit))"
                            [routerLink]="isLocalNetworkAdmin ? ['/network-country/network-country-create-edit-action', action.id, {'isLocalNetworkAdmin':true}] : ['/network-country/network-country-create-edit-action', action.id]"
                            class="btn btn-block">{{"EDIT_ACTION" | translate}}</a>
                        </div>
                        <!--<div class="col-md-3 col-sm-4 btn-block"-->
                        <!--*ngIf="isViewing && (action.type == ActionType.custom || (action.type == ActionType.mandated && !isSameAgency))">-->
                        <!--<a href="javascript:void(0)" (click)="copyAction(action)"-->
                        <!--class="btn btn-outline-primary btn-block ">{{"COPY_ACTION" | translate}}:</a>-->
                        <!--</div>-->
                      </div>
                      <div class="row">
                        <div class="subrow-line">{{"AGENCY_ADMIN.SETTINGS.RESPONSE_PLAN_SECTION_SETTINGS.BUDGET" |
                          translate}}: <strong>{{CURRENCIES[currency]}}{{action.budget}}</strong></div>
                        <div class="subrow-line">{{"GLOBAL.TYPE" | translate}}: <strong>{{ACTION_TYPE[action.type] |
                          translate}}</strong>
                        </div>
                        <div class="subrow-line">{{"GLOBAL.DEPARTMENT" | translate}}: <strong>{{DEPARTMENT_MAP.get(action.department)}}</strong>
                        </div>
                        <div class="subrow-line">{{"ASSIGNED_TO" | translate}}: <strong>{{CURRENT_USERS.get(action.asignee)
                          != null ?
                          CURRENT_USERS.get(action.asignee).firstName + ' ' + CURRENT_USERS.get(action.asignee).lastName
                          : ("UNASSIGNED" | translate)}}</strong></div>

                      </div>
                    </div>


                    <div id="notes_popover_{{action.id}}"
                         class="Popover__ribbon prevent_parent_collapse collapse col-12 notes-popover">
                      <!-- Notes -->
                      <div class="row Spaced">
                        <div class="col-md-2"></div>
                        <div class="col-md-7">
                          <div class="row">
                            <div class="col-3">
                              <h4>{{"GLOBAL.NOTES" | translate}}</h4>
                            </div>
                            <div class="col-9">
                              <p>
                                <tooltip
                                  [level1]="'TOOLTIPS.PREPAREDNESS.TT5.LEVEL1'">
                                </tooltip>
                              </p>
                            </div>
                          </div>
                          <div class="row" *ngIf="userType == userTypes.CountryDirector || userType == userTypes.RegionalDirector || userType == userTypes.CountryAdmin || !userType
                                               || (isViewing && permissionsAreEnabled.notes.New) || (action.noteId != null && action.noteId != '')">
                            <div class="col-12 form-group">
                        <textarea name="confirm_complete" cols="40" rows="4" class="form-control"
                                  placeholder="{{'ADD_A_COMPLETION_NOTE_HERE' | translate}}"
                                  [(ngModel)]="action.note"></textarea>
                            </div>
                          </div>
                          <div class="row notes-popover__item Small-spaced" *ngFor="let note of action.notes">
                            <div class="col-sm-3">{{note.time | date:"d MMM yyyy"}}</div>
                            <div class="col-sm-9">
                              <div class="row">
                                <div class="col-12">
                                  {{note.content}}
                                </div>
                              </div>
                              <div class="row align-items-center">
                                <div class="col-6 text-bold Small-spaced">
                                  <p><span>{{"BY" | translate}}:</span> {{CURRENT_USERS.get(note.uploadedBy) != null ?
                                    CURRENT_USERS.get(note.uploadedBy).firstName + ' ' +
                                    CURRENT_USERS.get(note.uploadedBy).lastName : ("UNASSIGNED" | translate)}}</p>
                                </div>
                                <div class="col-6 text-bold text-right"
                                     *ngIf="userType == userTypes.CountryDirector || userType == userTypes.RegionalDirector || userType == userTypes.CountryAdmin || !userType
                                                || note.uploadedBy == uid && note.id != action.noteId">
                                  <a
                                    *ngIf="(note.uploadedBy == uid && !isViewing) || (note.uploadedBy == uid && isViewing && permissionsAreEnabled.notes.Edit)"
                                    href="javascript:void(0);" class="text-primary"
                                    (click)="editNote(note, action)">{{"EDIT" | translate}}</a>
                                  | <a
                                  *ngIf="(note.uploadedBy == uid && !isViewing) || (note.uploadedBy == uid && isViewing && permissionsAreEnabled.notes.Delete)"
                                  href="javascript:void(0);" class="text-danger"
                                  (click)="deleteNote(note, action)">{{"DELETE" | translate}}</a>
                                </div>
                                <div class="col-6 text-bold text-right" *ngIf="note.id == action.noteId">
                                  {{"EDITING" | translate}}
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-3 btn-block">
                          <a *ngIf="userType == userTypes.CountryDirector || userType == userTypes.RegionalDirector || userType == userTypes.CountryAdmin || !userType
                                                || (isViewing && permissionsAreEnabled.notes.New) || (action.noteId != null && action.noteId != '')"
                             href="javascript:void(0)" class="btn btn-primary btn-block"
                             (click)="addNote(action)">{{action.noteId != null && action.noteId != ''? ("SAVE_NOTE" |
                            translate) :
                            ("ADD_NOTE" | translate)}}</a>
                          <a href="javascript:void(0)" class="btn btn-block" (click)="disableEditNote(action)"
                             onClick="$(this).parent().parent().parent().collapse('hide')">{{"GLOBAL.CANCEL" |
                            translate}}</a>
                          <a href="javascript:void(0)" class="btn btn-block" (click)="disableEditNote(action)"
                             *ngIf="action.noteId != null && action.noteId != ''">{{"STOP_EDITING" | translate}}</a>
                        </div>
                      </div>

                    </div>

                    <div id="documents_popover_{{action.id}}"
                         class="Popover__ribbon prevent_parent_collapse collapse col-12 documents-popover">
                      <!-- Documents -->
                      <div class="row Spaced">
                        <div class="col-md-2"></div>
                        <div class="col-md-10">
                          <div class="row Spaced align-items-center">
                            <div class="col-sm-6 col-8">
                              <h4><span>{{"DOCUMENTS_TEXT" | translate}} </span>({{action.documents.length}})</h4>&nbsp;&nbsp;<a
                              *ngIf="userType == userTypes.CountryAdmin" href="javascript:void(0);"
                              class="text-nowrap"
                              (click)="exportAllDocuments(action)">{{"DOWNLOAD_ALL" | translate}}</a>
                            </div>
                            <div class="col-sm-6 col-4 text-right">
                              <a (click)="closeDocumentsModal('documents_popover_' + action.id)"
                                 href="javascript:void(0)" class="btn btn-block">{{"GLOBAL.CLOSE" | translate}}</a>
                            </div>
                          </div>
                          <div class="row documents-popover__item">
                            <div class="col-12">
                              <p *ngFor="let doc of action.documents; let i = index" [attr.data-index]="i">
                                <strong>{{action.documents[i].fileName}}</strong>&nbsp;&nbsp;<span><a
                                *ngIf="uid == doc.uploadedBy || userType == userTypes.CountryAdmin || (isViewing && permissionsAreEnabled.other.DownloadDocuments)"
                                href="javascript:void(0);" (click)="exportDocument(action, i)">{{"DOWNLOAD" | translate}}</a> |
                                <a *ngIf="uid == doc.uploadedBy || userType == userTypes.CountryAdmin"
                                   href="javascript:void(0);" class="text-danger"
                                   (click)="deleteDocument(action, doc.documentId)">{{"DELETE" | translate}}</a></span>
                              </p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div><!-- end #wrap -->
</div>

<!--Lead Agency Selection Modal (first time agency is invited)-->
<div class="modal fade" id="leadAgencySelection" tabindex="-1" role="dialog"
     aria-labelledby="leadAgencySelection"
     aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="modal-title" class="Spaced-above">{{"ASSIGN_THIS_ACTION" | translate}}</h6>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p class="col-sm-12"><strong>{{"ASSIGN_TO" | translate}}</strong></p>
        <div class="col-sm-12">
          <select class="form-control" [(ngModel)]="assignActionAsignee"
                  *ngIf="userType == UserType.CountryDirector || userType == UserType.CountryAdmin || userType == UserType.ErtLeader">
            <option value="0" disabled selected hidden>{{'GLOBAL.PLEASE_SELECT'| translate}}</option>
            <option *ngFor="let x of ASSIGNED_TOO; let i = index" [attr.data-index]="i" value="{{x.id}}">{{x.firstName +
              ' ' + x.lastName}}
            </option>
          </select>

          <select class="form-control" [(ngModel)]="assignActionAsignee" *ngIf="userType == UserType.Ert || !userType">
            <option value="0" disabled selected hidden>{{'GLOBAL.PLEASE_SELECT'| translate}}</option>
            <option value="{{uid}}">{{myFirstName + ' ' + myLastName}}</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <div class="row Right-aligned Spaced col-sm-12">
          <a class="col-sm-9 margin-top-one"
             (click)="closeModal()">{{"GLOBAL.CANCEL" | translate}}</a>
          <button
            class="btn btn-primary col-sm-3 text-uppercase" (click)="saveAssignedUser()">{{"SAVE" | translate}}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
